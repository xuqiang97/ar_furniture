<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Furniture Placement</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <div id="container" style="width: 100%; height: 100%; position: relative;"></div>
  <script>
    let camera, scene, renderer, model;
    let container = document.getElementById("container");

    async function init() {
      scene = new THREE.Scene();

      // Set up camera
      camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 2, 5);

      // Set up renderer
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      container.appendChild(renderer.domElement);

      // Add lighting
      const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
      scene.add(ambientLight);

      const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
      dirLight.position.set(10, 10, 10);
      scene.add(dirLight);

      // Set up camera background
      await setupCameraBackground();

      // Add 3D model
      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshStandardMaterial({ color: 0x00ff00 });
      model = new THREE.Mesh(geometry, material);
      model.position.set(0, 0, -2); // Place in front of the camera
      scene.add(model);

      console.log('Model added to scene:', model);

      // Handle resizing
      window.addEventListener("resize", onWindowResize, false);

      animate();
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    async function setupCameraBackground() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        const video = document.createElement("video");
        video.srcObject = stream;
        video.play();

        const videoTexture = new THREE.VideoTexture(video);
        const bgScene = new THREE.Scene();
        const bgCamera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);
        const bgMaterial = new THREE.MeshBasicMaterial({ map: videoTexture });
        const bgPlane = new THREE.Mesh(new THREE.PlaneGeometry(2, 2), bgMaterial);
        bgScene.add(bgPlane);

        scene.userData.bgScene = bgScene;
        scene.userData.bgCamera = bgCamera;

      } catch (error) {
        console.error("Error accessing camera:", error);
      }
    }

    function animate() {
      requestAnimationFrame(animate);

      // Render background
      if (scene.userData.bgScene && scene.userData.bgCamera) {
        renderer.autoClear = false;
        renderer.clear();
        renderer.render(scene.userData.bgScene, scene.userData.bgCamera);
      }

      // Render main scene
      renderer.render(scene, camera);
    }

    init();
  </script>
</body>
</html>
